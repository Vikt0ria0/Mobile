<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Mobile.ViewModels"
             xmlns:models="clr-namespace:Mobile.Models"
             x:Class="Mobile.Views.MainGoalsPage"
             x:DataType="vm:MainGoalsViewModel"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{StaticResource BackgroundColor}">

    <Grid x:Name="MainGrid">
        <Grid.GestureRecognizers>
            <SwipeGestureRecognizer Direction="Right" Command="{Binding NavigateToDailyGoalsCommand}"/>
            <SwipeGestureRecognizer Direction="Left" Command="{Binding NavigateToCalendarCommand}"/>
        </Grid.GestureRecognizers>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€Ñ -->
        <Grid Grid.Row="0" Margin="20,20,20,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Label Text="ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ†ÐµÐ»Ð¸"
                   FontSize="24"
                   FontAttributes="Bold"
                   TextColor="{StaticResource PrimaryColor}"
                   VerticalOptions="Center"/>

            <Button Grid.Column="1"
                    Text="ðŸ“…"
                    FontSize="20"
                    Command="{Binding NavigateToCalendarCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{StaticResource SubtextColor}"/>
        </Grid>

        <VerticalStackLayout Spacing="20" Padding="20">
            <!-- Ð’ÐµÑ€Ñ…Ð½ÑÑ Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð½Ð°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ð¸ -->
            <Grid ColumnDefinitions="*,*,*">
                <Label Text="Ð¦ÐµÐ»Ð¸ Ð½Ð° Ð´ÐµÐ½ÑŒ" 
                       TextColor="{StaticResource SubtextColor}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding NavigateBackCommand}"/>
                    </Label.GestureRecognizers>
                </Label>
                <Label Grid.Column="1" 
                       Text="ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ†ÐµÐ»Ð¸" 
                       FontAttributes="Bold"
                       TextColor="{StaticResource PrimaryColor}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
                <Label Grid.Column="2" 
                       Text="ÐšÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ÑŒ" 
                       TextColor="{StaticResource SubtextColor}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
            </Grid>

            <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ†ÐµÐ»ÐµÐ¹ -->
            <CollectionView ItemsSource="{Binding Goals}"
                           Margin="0,20,0,0">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:MainGoal">
                        <Frame Margin="0,0,0,15"
                               Padding="15"
                               BackgroundColor="{StaticResource SecondaryColor}"
                               CornerRadius="15"
                               HasShadow="False">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainGoalsViewModel}}, Path=EditGoalCommand}"
                                                    CommandParameter="{Binding .}"/>
                            </Frame.GestureRecognizers>
                            <Grid RowDefinitions="Auto,Auto,Auto">
                                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                                <Label Text="{Binding Title}"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource TextColor}"/>
                                
                                <!-- Ð”ÐµÐ´Ð»Ð°Ð¹Ð½ Ð¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ -->
                                <StackLayout Grid.Row="1" 
                                           Spacing="5"
                                           Margin="0,5,0,10">
                                    <Label Text="{Binding DeadlineFormatted}"
                                           FontSize="14"
                                           TextColor="{StaticResource SubtextColor}"/>
                                    <Label Text="{Binding CategoryFormatted}"
                                           FontSize="14"
                                           TextColor="{StaticResource SubtextColor}"/>
                                </StackLayout>

                                <!-- ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ Ð±Ð°Ñ€Ñ‹ -->
                                <Grid Grid.Row="2" 
                                      RowDefinitions="Auto,Auto"
                                      RowSpacing="10">
                                    <StackLayout Spacing="5">
                                        <Label Text="Ð¡Ñ€Ð¾Ñ‡Ð½Ð¾ÑÑ‚ÑŒ:"
                                               FontSize="12"
                                               TextColor="{StaticResource SubtextColor}"/>
                                        <ProgressBar Progress="{Binding Urgency, Converter={StaticResource IntToDoubleConverter}}"
                                                   HeightRequest="6"
                                                   ProgressColor="{StaticResource AccentColor}"/>
                                    </StackLayout>

                                    <StackLayout Grid.Row="1" 
                                              Spacing="5">
                                        <Label Text="ÐžÐ±ÑŠÐµÐ¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ:"
                                               FontSize="12"
                                               TextColor="{StaticResource SubtextColor}"/>
                                        <ProgressBar Progress="{Binding Progress, Converter={StaticResource IntToDoubleConverter}}"
                                                   HeightRequest="6"
                                                   ProgressColor="{StaticResource PrimaryColor}"/>
                                    </StackLayout>
                                </Grid>

                                <!-- Ð˜Ð»Ð»ÑŽÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ -->
                                <Image Grid.RowSpan="3"
                                       Source="{Binding Image}"
                                       HorizontalOptions="End"
                                       VerticalOptions="Center"
                                       HeightRequest="80"
                                       WidthRequest="80"
                                       Aspect="AspectFit"
                                       Margin="0,0,-5,0"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ -->
            <Button Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ†ÐµÐ»ÑŒ"
                    Command="{Binding AddGoalCommand}"
                    BackgroundColor="{StaticResource PrimaryColor}"
                    TextColor="White"
                    FontAttributes="Bold"
                    CornerRadius="25"
                    HeightRequest="50"
                    Margin="0,10,0,0"/>
        </VerticalStackLayout>
    </Grid>
</ContentPage> 